#include <stdint.h>

#define SINE_TABLE_SIZE 256
#define SINE_VALUE_MAX 1024


const uint16_t sineLookupTable[] = {    
    512, 525, 537, 550, 562, 575, 587, 600,
    612, 624, 636, 649, 661, 673, 684, 696,
    708, 719, 731, 742, 753, 764, 775, 786,
    796, 807, 817, 827, 837, 846, 856, 865,
    874, 883, 891, 900, 908, 916, 923, 931,
    938, 945, 951, 957, 964, 969, 975, 980,
    985, 990, 994, 998, 1002, 1005, 1009, 1012,
    1014, 1016, 1018, 1020, 1022, 1023, 1023, 1024,
    1024, 1024, 1023, 1023, 1022, 1020, 1018, 1016,
    1014, 1012, 1009, 1005, 1002, 998, 994, 990,
    985, 980, 975, 969, 964, 957, 951, 945,
    938, 931, 923, 916, 908, 900, 891, 883,
    874, 865, 856, 846, 837, 827, 817, 807,
    796, 786, 775, 764, 753, 742, 731, 719,
    708, 696, 684, 673, 661, 649, 636, 624,
    612, 600, 587, 575, 562, 550, 537, 525,
    512, 499, 487, 474, 462, 449, 437, 424,
    412, 400, 388, 375, 363, 351, 340, 328,
    316, 305, 293, 282, 271, 260, 249, 238,
    228, 217, 207, 197, 187, 178, 168, 159,
    150, 141, 133, 124, 116, 108, 101, 93,
    86, 79, 73, 67, 60, 55, 49, 44,
    39, 34, 30, 26, 22, 19, 15, 12,
    10, 8, 6, 4, 2, 1, 1, 0,
    0, 0, 1, 1, 2, 4, 6, 8,
    10, 12, 15, 19, 22, 26, 30, 34,
    39, 44, 49, 55, 60, 67, 73, 79,
    86, 93, 101, 108, 116, 124, 133, 141,
    150, 159, 168, 178, 187, 197, 207, 217,
    228, 238, 249, 260, 271, 282, 293, 305,
    316, 328, 340, 351, 363, 375, 388, 400,
    412, 424, 437, 449, 462, 474, 487, 499
};

// angle in range 0 .. 255
int16_t sine(uint16_t angle)
{
    int16_t res = sineLookupTable[angle%256];
    res = res - 512;

    return res;
}

void MotorControl::set_torque_from_rotation(int32_t torque, uint32_t rotor_angle, bool brake);